@using Abence.WEB.Components.Pages.Login
@using Abence.WEB.Services.StorageServices
@using Abence.WEB.Utils
@inject IStorageService StorageService
@inject AuthenticationStateProvider AuthStateProvider
@inherits LayoutComponentBase

<div class="min-h-screen flex items-center justify-center bg-gray-50">
    <main class="w-full text-center space-y-8 p-4">
        @if (!isLoad)
        {
            <p>Cargando...</p>
        }
        else
        {
    
            <CascadingAuthenticationState>
                <AuthorizeView>
                    <Authorized>
                        @Body
                    </Authorized>
                    <NotAuthorized>
                        <Login />
                    </NotAuthorized>
                </AuthorizeView>
            </CascadingAuthenticationState>
    
        }
    </main>
</div>


@* <div id="blazor-error-ui" data-nosnippet>
    An unhandled error has occurred.
    <a href="." class="reload">Reload</a>
    <span class="dismiss">🗙</span>
</div> *@

@code {
    private bool isLoad = false;

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            isLoad = true;
            StorageService.InitializeForClientSide();
            await ((AuthStateProvider)AuthStateProvider).GetAuthenticationStateAsync();
            StateHasChanged();
        }
        else
        {
            isLoad = true;
        }
    }
}